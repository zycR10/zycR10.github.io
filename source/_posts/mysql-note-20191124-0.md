---
title: MySQL学习笔记（十一）怎么给字符串字段加索引？
date: 2019-11-24 18:55:22
categories:
- MySQL
---
***本文摘要 前缀索引，覆盖索引***
<!--more-->

## 字符串索引
假设存在一张用户表t_user_info, 表中存在用户姓名user_name, 日常使用中可能会存在这样的sql
```
select * from t_user_info where user_name = 'xxx';
```

在MySQL中如果需要为字符串添加索引有两种方式：
```
alter table t_user_info add index index1(user_name);
alter table t_user_info add index index2(user_name(2));
```
第一个索引表示整个字段作为索引，第二个索引表示前两个字节作为索引，使用第二种索引方式的话能够节约空间，但是相应的索引区分度可能没有全字段高，导致查询的过程中可能会扫描更多行数据，但是如果恰当的设置前缀索引，**那么就可以在节约空间成本的基础上又不额外增加更多的查询成本，所以需要在工作中根据业务特点和数据特性设置好前缀索引的长度。**

## 前缀索引对覆盖索引的影响
显而易见，一旦选择使用前缀索引，那么肯定会无法使用覆盖索引，因为一定需要回表查询。

## 其他方式
对于名字或者邮箱之类的字符串，也许前缀索引的效果还不错，但是假如说你需要为一个区分度不够高的字符串添加索引，例如身份证字段，显然需要建一个长度很长的前缀索引才能达到目的，这种情况下有如下的解决办法

* 倒叙存储
利用数据特性，在数据库中倒叙存储字段可以达到使用较短的前缀索引区分数据的目的，查询sql可以这样：
```
select * from t_user_info where id_card = reverse('xxx');
```

* 使用hash区分
再增加一个字段hash值，并增加hash值索引
```
mysql> alter table t add id_card_crc int unsigned, add index(id_card_crc);
```
在查询的时候相应的需要这样写
```
mysql> select field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string'
```

## 小结
1. 直接创建完整索引，这样可能比较占用空间；
2. 创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引；
3. 倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题；
4. 创建 hash 字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描。 

