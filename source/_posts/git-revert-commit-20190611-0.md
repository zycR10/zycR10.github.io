---
title: git撤销本地commit文件
date: 2019-06-11 23:34:06
tags: wrong
categories: git
---
今天在提交代码的时候出现了一个失误，折腾了一会儿才解决，也不知道是不是正确的解决方案，特此记录一下。
事件背景是这样的，今天下午的时候写完了代码打算提交，在本地操作了git add和git commit之后刚要push，突然发现当前分支是master，公司是有规定的一般情况下不能直接提交在master上，尤其是还未测试的代码，因为上线流程会从master上打tag进行打包，如果直接提交在master上可能造成未测试代码直接上线，所以一般都是自己打出来自己的branch，在branch上进行操作。写代码的时候估计是着急了没注意，一直在master上写的，在push之前才发现问题。
这时我的解决方案是打了新的branch然后把master代码合并到了我的新分支上，但是提交的时候由于当前分支没有commit内容，git status时发现为空，导致代码push失败，于是我的想法是撤销刚刚在master上commit的代码，重新在branch中操作（不知道这里的操作是否正确，其实总是隐约的觉得怪怪的，应该还有更好的办法），以下是当时折腾出来的操作，特此记录一下：

**1.git log**
log命令会显示出历史记录，第一条log就是刚刚错误commit的记录，上面记录了author提交人，Date时间，提交时填写的-m信息，以及一个commit hash码也可以说是版本号

**2.git reset --hard/soft/mixed commit-hash**
然后使用reset命令就可以了，但是这里有个知识点必须注意，如果使用--soft是仅仅移动了本地库的HEAD指针，也就是说暂存区和本地代码库并没有改变，相当于回退到了没有commit的阶段；--mixed表示移动了HEAD指针并且重置了暂存区，相当于回退到了还没有add的阶段；--hard就比较厉害了，移动HEAD指针，重置暂存区，重置工作区，说白了就是你的代码都被回退了，所以这个操作要谨慎。当然了其实如果你什么都不写，默认就是--mixed，也说明其实回退到未add状态应该是大多数人想做的操作。